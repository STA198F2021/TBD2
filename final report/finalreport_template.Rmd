---
title: "Final Report"
subtitle: "due November 16, 2021 by 11:59 PM "
author: "Harris Upchurch, Biniam Garomsa, Philemon Hailemariam"
date: "11/16/2021"
output: pdf_document
---
Outline:

#Introduction

Starting in 2020, public health measures against the spread of respiratory disease were taken in an effort to slow or prevent the spread of COVID-19. These measures were much more significant than in previous years, as the primary strategies against the spread of respiratory disease in the United States are typically vaccination and encouraging frequent hand-washing, but measures against COVID-19 included shutting down large parts of society and moving online, as well as enforcement or encouragement of face coverings and vaccinations when available. This report studies how these public health measures may have affected the spread of other infectious disease by focusing on influenza hospitalizations and deaths in the United States, as the flu is one of the most common and deadly diseases each year in the U.S., and shares many characteristics with COVID-19.

#Flu seasons during the COVID-19 Pandemic vs. past flu seasons

Have flu deaths and hospitalizations changed during the COVID-19 pandemic compared to past years? If so, is this difference statistically significant?
```{r seasons compare}
#data/libraries
library(dplyr)
library(tidyverse)
library(viridis)
ilinet <-read.csv("~/R/TBD2/data/ILINet.csv", header=TRUE)
flu<-readr::read_csv(file = '~/R/TBD2/data/State_Custom_Data.csv')
#data merging
flu2<-flu%>%
  mutate(Year = ifelse(WEEK>=40 & WEEK<=53, substr(SEASON,3,4),substr(SEASON,6,7)))%>%
  mutate(Year = paste("20",Year,sep=""))
flu2$WEEK<- as.numeric(flu2$WEEK)
flu2$Year<- as.numeric(flu2$Year)
ilinet$YEAR<-as.numeric(ilinet$YEAR)
ilinet$WEEK<- as.numeric(ilinet$WEEK)
flu_ili <- left_join(flu2,ilinet,by=c("SUB AREA" ="REGION","WEEK","Year"="YEAR"))
flu_ili<-flu_ili%>% rename("YEAR" = "Year","STATE" ="SUB AREA")
aggflu_ili <- flu_ili %>%
  mutate(year = as.character(YEAR), week = as.character(WEEK), total_flu = as.numeric(ILITOTAL)) %>%
  mutate(yearweek = ifelse(WEEK <= 9,paste(year, week, sep = '0'),paste(year, week, sep = ''))) %>%
  drop_na()%>%
  group_by(yearweek)%>%
  summarize(total_flu_patients = sum(total_flu),total_flu_deaths = sum(`NUM INFLUENZA DEATHS`))%>%
  transform(yearweek = as.numeric(yearweek))%>%
  mutate(covidstatus = ifelse(yearweek>=202009,1,0))%>%
  transform(yearweek = rank(yearweek, ties.method = 'min'))
#line graph
ggplot(aggflu_ili, aes(x = yearweek)) +
  geom_area(aes(y = total_flu_patients), alpha = 0.5) +
  geom_area(aes(y = covidstatus*1600), alpha = 0.2) +
  labs(title = 'U.S. Influenza Patients',
       subtitle = 'CDC FLuView, 2013-2021',
       x = 'Weeks since beginning of 2013',
       y = 'Patients with influenza-like symptoms (excluding other diagnoses)')
ggplot(aggflu_ili, aes(x = yearweek)) +
  geom_area(aes(y = total_flu_deaths), alpha = 0.5) +
  geom_area(aes(y = covidstatus*1600), alpha = 0.2) +
  labs(title = 'U.S. Influenza Deaths',
       subtitle = 'CDC FLuView, 2013-2021',
       x = 'Weeks since beginning of 2013',
       y = 'Influenza deaths')
```

```{r table}
#table
aggflu_ili %>%
  mutate(season = ifelse(yearweek >=1 & yearweek <= 52, '2013-2014', 
                  ifelse(yearweek >=53 & yearweek <= 104, '2014-2015',
                  ifelse(yearweek >=105 & yearweek <= 156, '2015-2016',
                  ifelse(yearweek >=157 & yearweek <= 208, '2016-2017',
                  ifelse(yearweek >=209 & yearweek <= 260, '2017-2018',
                  ifelse(yearweek >=261 & yearweek <= 312, '2018-2019',
                  ifelse(yearweek >=313 & yearweek <= 364, '2019-2020',
                  ifelse(yearweek >=365 & yearweek <= 416, '2020-2021','2021-2022'
  )))))))))%>%
  group_by(season) %>%
  summarize(total_flu_deaths = sum(total_flu_deaths), 
            total_flu_patients = sum(total_flu_patients))
```
Based on the data, the hospitalizations for the 2020-2021 flu season were similar to several seasons in past years, but noticeably lower than the most recent 2017-2019 seasons, with a total of 877,548 hospitalizations, which was somewhat higher than the 2013-2017 seasons, but less than half of the most recent season. The 2021-2022 season is not complete, but appears to be on track to be similar to years before the 2017-2019 period, like the 2020-2021 season. The deaths of both the 2020-2021 season and the 2021-2022 season were and have been noticeably less than any of the previous years used for this comparison. The 2020-2021 season had 25.1% of the deaths of the next least deadly year and 10.8% of the average deaths of previous seasons, and the 2021-2022 season is on track to follow a similar pattern. These findings indicate some noticeable differences between influenza effects before and during COVID-19, but statistical tests should be done to prove and quantify their difference.
```{r model}

```
    
#Comparison of lockdowns and flu levels by state/comparison of flu levels by lockdown stringency (?)
compare states/lockdown and mask levels (stringency index) to flu hospitalizations or deaths
  consider using a model
    test which model fits best
    test for and explain statistical significance
talk about why flu levels may be lower
  more protective measures against respiratory illnesses
  possibly more issues going to hospital for flu/collecting data
  is the population most affected by flu being reduced by COVID?